# This file defines the configuration for your ASA dedicated server container.
# It uses environment variables for easy customization.

services:
  asa-server:
    # Use the image you built and pushed to your GHCR repository
    image: ghcr.io/iceyman/ark-server-docker-dev:latest
    
    # CRITICAL: Use host network mode to avoid complex port mapping issues and ensure RCON/query works reliably.
    network_mode: host
    
    # CRITICAL: Increase kernel limits for stability when running Wine/Ark
    sysctls:
      vm.max_map_count: 16777216
    
    # Persistent storage for game files, saved data, and configuration
    volumes:
      - ./serverdata:/home/steam/server/ASA
      
    # Restart policy ensures the server attempts to recover from crashes
    restart: always

    environment:
      # --- General Server Settings ---
      - SERVER_NAME="My Awesome ASA Server"
      - SERVER_PASSWORD=""
      - SERVER_ADMIN_PASSWORD="supersecretadminpassword"
      - SERVER_MAP="TheIsland"
      - MAX_PLAYERS=20

      # --- Mod and Game Mode ---
      - MOD_LIST="939228,928597"  # Replace with your CurseForge Mod IDs (comma-separated)
      - SERVER_MODE=PVP          # Change to PVE for Player vs. Environment

      # --- Port Configuration ---
      - GAME_PORT=7777           # UDP Port for game connection
      - QUERY_PORT=27015         # UDP Port for server list query (Steam/Epic)
      - RCON_PORT=27020          # TCP Port for RCON tools

      # --- Rate Multipliers ---
      - XP_MULTIPLIER=1.0
      - HARVEST_MULTIPLIER=1.0
      - TAMING_SPEED=1.0
      - HATCHING_SPEED=1.0
      - MATURATION_SPEED=1.0

      # --- Additional Launch Arguments ---
      # Flags are passed directly to the server executable.
      # WinLive is for crossplay. PreventHibernation is CRITICAL for mod stability.
      # NOTE: MaxPlayers is handled dynamically in the script to avoid conflicts.
      - ADDITIONAL_ARGS="-crossplay -ForceModUpdate ?PreventHibernation=True"
